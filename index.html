<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>28 Days of Us</title>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;500;700&family=Playfair+Display:ital,wght@1,600&display=swap" rel="stylesheet">
    <style>
        :root { --primary: #ff4d6d; --glass: rgba(255, 255, 255, 0.15); --border: rgba(255, 255, 255, 0.25); }
        
        body { 
            margin: 0; min-height: 100vh; overflow-x: hidden;
            font-family: 'Outfit', sans-serif; color: #fff;
            background: linear-gradient(135deg, #1e3c72, #2a5298, #ff6b6b);
            background-size: 400% 400%;
            animation: gradientBG 15s ease infinite;
            display: flex; flex-direction: column; align-items: center; padding-bottom: 40px;
        }
        @keyframes gradientBG { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }

        .glass-panel {
            background: var(--glass);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            border: 1px solid var(--border);
            border-radius: 25px;
            padding: 20px;
            width: 85%; max-width: 400px;
            margin-bottom: 20px;
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.3);
            text-align: center;
        }

        .polaroid img { width: 100%; height: 380px; object-fit: cover; border-radius: 15px; background: rgba(0,0,0,0.1); }
        
        #error-debug { color: #ffeb3b; background: rgba(0,0,0,0.6); padding: 10px; font-size: 0.75rem; margin-top: 10px; display: none; border-radius: 10px; border: 1px solid #ffeb3b; }

        .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 8px; margin-top: 10px; }
        .day-bubble { aspect-ratio: 1; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 0.75rem; font-weight: bold; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.1); cursor: pointer; transition: 0.3s; }
        .day-bubble.unlocked { background: rgba(255,255,255,0.9); color: #1e3c72; }
        .day-bubble.active { background: var(--primary); color: white; box-shadow: 0 0 15px var(--primary); transform: scale(1.15); border: none; z-index: 5; }
        .day-bubble.locked { opacity: 0.2; cursor: not-allowed; }

        .scratch-box { position: relative; width: 100%; height: 100px; overflow: hidden; border-radius: 15px; margin-top: 15px; background: rgba(255,255,255,0.05); }
        .hidden-text { position: absolute; inset: 0; display:flex; align-items:center; justify-content:center; padding: 15px; font-style: italic; font-size: 1rem; text-shadow: 0 1px 3px rgba(0,0,0,0.5); line-height: 1.4; color: white; }
        canvas { position: absolute; top: 0; left: 0; z-index: 2; touch-action: none; }

        h1 { font-family: 'Playfair Display', serif; font-size: 2.2rem; margin: 15px 0; text-shadow: 0 2px 10px rgba(0,0,0,0.2); }
        .hug-btn { background: white; color: var(--primary); border: none; padding: 12px 30px; border-radius: 50px; font-weight: 700; margin-top: 10px; cursor: pointer; box-shadow: 0 4px 15px rgba(0,0,0,0.2); transition: 0.3s; }
        
        #game-screen { position: fixed; inset: 0; background: rgba(0,0,0,0.95); backdrop-filter: blur(10px); z-index: 1000; display: flex; flex-direction: column; align-items: center; justify-content: center; transition: 0.5s; }
        .heart-floater { font-size: 90px; cursor: pointer; animation: pulse 1s infinite alternate; filter: drop-shadow(0 0 20px var(--primary)); }
        @keyframes pulse { from { transform: scale(1); } to { transform: scale(1.1); } }
        
        .hidden { display: none; }
    </style>
</head>
<body>

    <div id="game-screen">
        <h2 style="font-family:'Playfair Display'; text-align:center; padding: 0 20px;">Every day is a gift...</h2>
        <div id="target-heart" class="heart-floater">üíù</div>
        <p style="color:#666; margin-top:30px; letter-spacing: 1px; font-size: 0.8rem;">CATCH THE HEART TO UNLOCK TODAY</p>
    </div>

    <div id="main-app" class="hidden">
        <h1 id="date-title"></h1>
        
        <div class="glass-panel">
            <div class="polaroid">
                <img id="display-img" src="" alt="Loading..." onerror="imageFailed(this)">
            </div>
            <div id="error-debug"></div>
            
            <div class="scratch-box">
                <div class="hidden-text" id="display-msg"></div>
                <canvas id="scratch-canvas"></canvas>
            </div>
            <button class="hug-btn" onclick="sendHug()">Send Hug ü§ó</button>
        </div>

        <div class="glass-panel" style="width: 92%; max-width: 420px;">
            <h3 style="margin: 0 0 15px 0; font-size: 0.9rem; opacity: 0.7; letter-spacing: 2px; font-weight: 300;">OUR FEBRUARY JOURNEY</h3>
            <div class="calendar-grid" id="calendar-wrapper"></div>
            <div id="days-left" style="margin-top: 20px; font-size: 0.8rem; opacity: 0.6; font-weight: 300;"></div>
        </div>
        
        <div style="font-size: 0.75rem; opacity: 0.7; margin-top: 10px; font-weight: 300;" id="distance-tag"></div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <script>
        // --- MANDATORY SETUP ---
        const SHEET_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSKqWbkDWDomm_5dSZhriAHQAx3EG_jPrulurvlmkdlUl7XoF4pkz5KT-5JMHyauG_JbzQBDAYsdbuS/pubhtml?gid=0&single=true'; 
        const YOUR_LAT = 26.1872; 
        const YOUR_LON = 91.6917; 
        // ------------------------

        let allData = [];
        let actualDayNum = 1; 

        function imageFailed(img) {
            const errBox = document.getElementById('error-debug');
            errBox.style.display = 'block';
            errBox.innerHTML = `‚ö†Ô∏è <b>Image Not Found</b><br>Tried: <i>${img.src}</i><br>Check if name matches GitHub exactly!`;
        }

        function init() {
            const options = { timeZone: 'Asia/Singapore', year: 'numeric', month: '2-digit', day: '2-digit' };
            const formatter = new Intl.DateTimeFormat('en-CA', options);
            const sgDate = formatter.format(new Date());
            actualDayNum = parseInt(sgDate.split('-')[2]); 

            loadData(actualDayNum);
        }

        const target = document.getElementById('target-heart');
        let clicks = 0;
        function moveHeart() {
            if (clicks < 2) {
                target.style.transition = "0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)";
                target.style.transform = `translate(${Math.random()*160-80}px, ${Math.random()*160-80}px)`;
                clicks++;
            } else {
                document.getElementById('game-screen').style.opacity = '0';
                setTimeout(() => {
                    document.getElementById('game-screen').style.display = 'none';
                    document.getElementById('main-app').classList.remove('hidden');
                }, 500);
            }
        }
        target.addEventListener('click', moveHeart);

        function loadData(dayToLoad) {
            Papa.parse(SHEET_URL, {
                download: true, header: true,
                complete: function(results) {
                    allData = results.data;
                    renderContent(dayToLoad);
                    renderCalendar(dayToLoad);
                }
            });
        }

        function renderContent(day) {
            const searchDate = `2026-02-${day.toString().padStart(2, '0')}`;
            const row = allData.find(r => r.Date && r.Date.trim() === searchDate);
            
            if (row) {
                document.getElementById('date-title').innerText = `February ${day}`;
                const imageName = row.ImageName.trim();
                document.getElementById('display-img').src = "images/" + imageName;
                document.getElementById('display-msg').innerText = row.Message;
                initScratch(); 
            }
        }

        function renderCalendar(currentView) {
            const grid = document.getElementById('calendar-wrapper');
            grid.innerHTML = ''; 
            for (let i = 1; i <= 28; i++) {
                const bubble = document.createElement('div');
                bubble.innerText = i;
                bubble.className = 'day-bubble';
                if (i === currentView) bubble.classList.add('active'); 
                else if (i <= actualDayNum) {
                    bubble.classList.add('unlocked'); 
                    bubble.onclick = () => { renderContent(i); renderCalendar(i); }; 
                } else {
                    bubble.classList.add('locked'); bubble.innerHTML = 'üîí';
                }
                grid.appendChild(bubble);
            }
            const left = 28 - actualDayNum;
            document.getElementById('days-left').innerText = `${left} SURPRISES REMAINING...`;
            calcDist();
        }

        function initScratch() {
            const canvas = document.getElementById('scratch-canvas');
            const ctx = canvas.getContext('2d');
            const parent = canvas.parentElement;
            canvas.width = parent.offsetWidth;
            canvas.height = parent.offsetHeight;
            
            const grd = ctx.createLinearGradient(0, 0, canvas.width, canvas.height);
            grd.addColorStop(0, '#bdc3c7');
            grd.addColorStop(1, '#2c3e50');
            ctx.fillStyle = grd;
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            ctx.fillStyle = "white";
            ctx.font = "bold 14px Outfit";
            ctx.textAlign = "center";
            ctx.fillText("SCRATCH TO READ ‚ú®", canvas.width/2, canvas.height/2 + 5);
            
            ctx.globalCompositeOperation = 'destination-out';

            function scratch(e) {
                e.preventDefault();
                const rect = canvas.getBoundingClientRect();
                const x = (e.clientX || (e.touches ? e.touches[0].clientX : 0)) - rect.left;
                const y = (e.clientY || (e.touches ? e.touches[0].clientY : 0)) - rect.top;
                ctx.beginPath();
                ctx.arc(x, y, 25, 0, Math.PI*2);
                ctx.fill();
            }
            canvas.addEventListener('mousemove', scratch);
            canvas.addEventListener('touchmove', scratch);
        }

        function sendHug() {
            for(let i=0; i<15; i++) {
                const h = document.createElement('div');
                h.innerText = '‚ù§Ô∏è';
                h.style.position = 'fixed';
                h.style.left = '50%'; h.style.top = '50%';
                h.style.transition = '2s'; h.style.pointerEvents = 'none'; h.style.zIndex = '3000';
                document.body.appendChild(h);
                setTimeout(() => {
                    h.style.transform = `translate(${(Math.random()-0.5)*400}px, ${(Math.random()-0.5)*600}px) scale(3) rotate(${Math.random()*360}deg)`;
                    h.style.opacity = '0';
                }, 10);
                setTimeout(() => h.remove(), 2000);
            }
        }
        
        function calcDist() {
            const SG_LAT = 1.3521; const SG_LON = 103.8198;
            const R = 6371; 
            const dLat = (SG_LAT-YOUR_LAT) * Math.PI/180;
            const dLon = (SG_LON-YOUR_LON) * Math.PI/180;
            const a = Math.sin(dLat/2)**2 + Math.cos(YOUR_LAT*Math.PI/180)*Math.cos(SG_LAT*Math.PI/180)*Math.sin(dLon/2)**2;
            const d = Math.round(R * 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a)));
            document.getElementById('distance-tag').innerText = `üìç ${d} KM APART, BUT TOGETHER FOREVER`;
        }

        init();
    </script>
</body>
</html>
